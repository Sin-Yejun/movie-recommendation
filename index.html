<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filmio - ì˜í™” ì¶”ì²œ í”Œë«í¼</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.2.0/markdown-it.min.js"></script>
    <script>
        async function sendMessage() {
            const url = "https://movie-recommendation-ayrm.onrender.com/chat";
            const message = document.getElementById("message").value;
            const responseContainer = document.getElementById("response");
            const submitButton = document.getElementById("submit-button");

            submitButton.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”
            submitButton.style.opacity = "0.5"; // ë²„íŠ¼ íë¦¬ê²Œ
            submitButton.innerText = "ìƒì„± ì¤‘...";

            try {
                const response = await fetch(url, {
                    method: "POST",
                    mode: "cors",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ query: message })
                });

                if (!response.ok) {
                    throw new Error("Network response was not ok " + response.statusText);
                }

                const data = await response.json();
                let text = data.response || "ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.";
                text = text
                    .replace(/### (.*?)(\n|$)/g, '<h3>$1</h3>$2')  // ê°€ì¥ ì‘ì€ ì œëª© ë¨¼ì € ë³€í™˜
                    .replace(/## (.*?)(\n|$)/g, '<h2>$1</h2>$2')   // h2 ë³€í™˜
                    .replace(/# (.*?)(\n|$)/g, '<h1>$1</h1>$2')    // h1 ë³€í™˜
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')  // **êµµì€ ê¸€ì”¨** ë³€í™˜
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/\n/g, '<br>');  // ê°œí–‰ ë³€í™˜
                responseContainer.innerHTML = text;
            } catch (error) {
                console.error("Error:", error);
                responseContainer.innerHTML = "Error: ì‘ë‹µì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            } finally {
                submitButton.disabled = false; // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                submitButton.style.opacity = "1";
                submitButton.innerText = "ğŸ¥ ë‹µë³€ ìƒì„±";
            }
        }

        async function loadMovies() {
            try {
                const response = await fetch('src/db/movies.json');
                const movies = await response.json();

                const gallery = document.querySelector('.image-gallery');
                gallery.innerHTML = '';

                movies.forEach((movie, index) => {
                    const movieItem = document.createElement('div');
                    movieItem.classList.add('image-item');
                    if (index >= 4) movieItem.style.display = "none";

                    movieItem.innerHTML = `
                        <img src="${movie.ì˜í™”í¬ìŠ¤í„°}" alt="${movie.ì œëª©}" onclick="setMovieQuery('${movie.ì œëª©}')">
                        <p>${movie.ì œëª©}</p>
                    `;
                    gallery.appendChild(movieItem);
                });
                showSlides(0);
            } catch (error) {
                console.error("Error loading movies:", error);
            }
        }

        function setMovieQuery(title) {
            document.getElementById("message").value = `${title}ì— ëŒ€í•œ ì •ë³´ ì•Œë ¤ì¤˜.`;
        }

        let currentIndex = 0;
        function showSlides(index) {
            const slides = document.querySelectorAll('.image-item');
            const totalSlides = slides.length;
            const itemsToShow = 4;

            if (index >= totalSlides) {
                currentIndex = 0;
            } else if (index < 0) {
                currentIndex = totalSlides - itemsToShow;
            } else {
                currentIndex = index;
            }

            slides.forEach((slide, i) => {
                slide.style.display = (i >= currentIndex && i < currentIndex + itemsToShow) ? 'block' : 'none';
            });
        }

        function nextSlides() {
            showSlides(currentIndex + 4);
        }

        function prevSlides() {
            showSlides(currentIndex - 4);
        }

        document.addEventListener('DOMContentLoaded', loadMovies);
    </script>
</head>

<body>
    <header>
        <h1>Filmio</h1>
        <div class="cinema-links">
            <a href="https://www.cgv.co.kr/" target="_blank"><img src="src/img/cgv_logo.png" alt="CGV"></a>
            <a href="https://www.lottecinema.co.kr/" target="_blank"><img src="src/img/lotte_logo.png" alt="ë¡¯ë°ì‹œë„¤ë§ˆ"></a>
            <a href="https://www.megabox.co.kr/" target="_blank"><img src="src/img/megabox_logo.png" alt="ë©”ê°€ë°•ìŠ¤"></a>
        </div>
    </header>

    <section class="info-container">
        <h2>ğŸ¬ ì˜í™” ì¶”ì²œ AI</h2>
        <p>ê´€ì‹¬ ìˆëŠ” ì˜í™”ì— ëŒ€í•´ ì§ˆë¬¸í•˜ì„¸ìš”! ì¤„ê±°ë¦¬, ë¦¬ë·°, ì¶œì—°ì§„ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
    </section>

    <form onsubmit="event.preventDefault(); sendMessage();">
        <input type="text" id="message" name="message" placeholder="ê¶ê¸ˆí•œ ì˜í™”ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." required>
        <button type="submit" id="submit-button">ğŸ¥ ë‹µë³€ ìƒì„±</button>
    </form>

    <section class="response-container">
        <h2>ë‹µë³€</h2>
        <div id="response"></div>
    </section>

    <section class="slider-container">
        <h2>í˜„ì¬ ìƒì˜ ì¤‘ì¸ ì˜í™”</h2>
        <div class="slider-content">
            <button class="slider-button" onclick="prevSlides()">&#10094;</button>
            <div class="image-gallery"></div>
            <button class="slider-button" onclick="nextSlides()">&#10095;</button>
        </div>
    </section>
</body>

</html>